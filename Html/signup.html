<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>signup</title>
    <link rel="stylesheet" href="../css/signup.css">
</head>
<body>
    <div>
        <div class="logo">
            <a href="">Read<span>wave</span></a>
        </div>
        <div id="toastbox">

        </div>
        <div class="wrapper">
            <h1>Let's Get Started</h1>
               <div class="input-box">
                <input type="text" id="fname" placeholder="User Name">
    
               </div>
               <div class="input-box">
                <input type="text" id="email" placeholder="Email">
               </div>
               <div class="input-box">
                <input type="password" id="pwd" placeholder="Password">
    
               </div>
               
            <div class="select">
                <div class="select-btn" id="sel-btn">
                    <span class="btn-text">
                        Select three subjects of interest
                    </span>
                    <span class="arrow-down"><i class="fa-solid fa-chevron-down"></i></span>
                </div>
                <div id="sel">
                    <ul class="list-items">
                        <li class="items">
                            <span class="checkbox">
                                <input type="checkbox" class="check-box" value="History">
                            </span>
                            <span class="item-text">History</span>
                        </li>
                        <li class="items">
                            <span class="checkbox">
                                <input type="checkbox" class="check-box" value="Business">
                            </span>
                            <span class="item-text">Business </span>
                        </li>
                        <li class="items">
                            <span class="checkbox">
                                <input type="checkbox" class="check-box" value="Bedtime Books">
                            </span>
                            <span class="item-text">Bedtime Books</span>
                        </li>
                        <li class="items">
                            <span class="checkbox">
                                <input type="checkbox" class="check-box" value="Science">
                            </span>
                            <span class="item-text">Science</span>
                        </li>
                        <li class="items">
                            <span class="checkbox">
                                <input type="checkbox" class="check-box" value="Health">
                            </span>
                            <span class="item-text">Health</span>
                        </li>
                        <li class="items">
                            <span class="checkbox">
                                <input type="checkbox" class="check-box" value="Fiction">
                            </span>
                            <span class="item-text">Fiction</span>
                        </li>
                    </ul>
                </div>
            </div>
            <button class="btn" onclick="saveData()">Sign Up</button>
          
    </div>

    <script>  
        function saveData() {
            let fname, email, pwd;
            fname = document.getElementById("fname").value;
            email = document.getElementById("email").value;
            pwd = document.getElementById("pwd").value;
            const checkboxes = document.querySelectorAll('.check-box:checked');

             if (fname === "") {
                displayToast("Enter name", "toast3", "fa-circle-check succ");
            } else if (email === "") {
                displayToast("Enter email", "toast3", "fa-circle-check succ");
            } else if (!isValidEmail(email)) {
                displayToast("Enter a valid email address", "toast3", "fa-circle-check succ");
            } else if (pwd === "") {
                displayToast("Enter password", "toast3", "fa-circle-check succ");
            } else  if (checkboxes.length === 0) {
                displayToast("Please select  subject before proceeding.", "toast1");
            }else
            {
                const signupButton = document.querySelector(".btn");
                signupButton.disabled = true;
                const user = {
                    fname,
                    email,
                    pwd,
                };

                const dataBase = JSON.parse(localStorage.getItem("user")) || [];
                if (dataBase.some((v) => v.email === email)) {
                    displayToast("Email Already In Use", "toast2", "fa-circle-check succ");
                    signupButton.disabled = false;
                } else {
                    dataBase.push(user);
                    localStorage.setItem("user", JSON.stringify(dataBase));
                    console.log(dataBase);

                    document.getElementById("fname").value = "";
                    document.getElementById("email").value = "";
                    document.getElementById("pwd").value = "";

                    displayToast("Account was created successfully", "toast1", "fa-circle-check succ");
                    setTimeout(() => {
                        window.location.href = "login.html";
                    }, 1000);
                }
            }
        } 
        
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function handleCheckboxClick() {
            const selectedSubjects = [];
            const checkboxes = document.querySelectorAll('.check-box:checked');

            if (checkboxes.length > 3) {
                event.target.checked = false;
                return; // Only allow selecting up to three items
            }

            checkboxes.forEach(function (checkbox) {
                selectedSubjects.push(checkbox.value);
            });

        
            localStorage.setItem('selectedSubjects', JSON.stringify(selectedSubjects));
        }

        // Add click event listener to checkboxes
        const checkboxes = document.querySelectorAll('.check-box');
        checkboxes.forEach(function (checkbox) {
            checkbox.addEventListener('click', handleCheckboxClick);
        });

        function displayToast(message, style, icon) {
            const toastbox = document.getElementById("toastbox");
            const toast = document.createElement("div");
            toast.className = style;
            toast.innerHTML = `<i class="${icon}"></i>${message}`;
            toastbox.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        
  

    </script>

<script src="https://unpkg.com/ionicons@4.5.10-0/dist/ionicons.js"></script>
</body>
</html>